<?php

namespace Appstore\Bundle\AssetsBundle\Repository;
use Appstore\Bundle\AssetsBundle\Entity\AssetsConfig;
use Appstore\Bundle\AssetsBundle\Entity\Depreciation;
use Appstore\Bundle\AssetsBundle\Entity\DepreciationModel;
use \Doctrine\ORM\EntityRepository;

/**
 * ProductDistributionRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class DepreciationRepository extends EntityRepository
{

    public function insertDefaultDepreciation(AssetsConfig $config)
    {
        $em = $this->_em;
        $depreciation = new Depreciation();
        $depreciation->setConfig($config);
        $depreciation->setDepreciationPulse('monthly');
        $depreciation->setModel('cost');
        $depreciation->setPolicy('reducing-balance');
        $depreciation->setDepreciationYear(5);
        $depreciation->setRate(10);
        $depreciation->setEffected('1 month');
        $em->persist($depreciation);
        $em->flush();

        $em = $this->_em;
        $entity = new DepreciationModel();
        $entity->setConfig($config);
        $entity->setDepreciation($depreciation);
        $entity->setName("Default");
        $entity->setAssetsType("intangible");
        $entity->setDepreciationYear($depreciation->getDepreciationYear());
        $entity->setRate($depreciation->getRate());
        $entity->setIsDefault(1);
        $em->persist($entity);
        $em->flush();
        return $depreciation;

    }

    public function updateDefaultDepreciation(Depreciation $depreciation)
    {
        $em = $this->_em;
        $entity = $em->getRepository('AssetsBundle:DepreciationModel')->findOneBy(array('depreciation' => $depreciation));
        $entity->setDepreciationYear($depreciation->getDepreciationYear());
        $entity->setRate($depreciation->getRate());
        $em->persist($entity);
        $em->flush();
    }



}
