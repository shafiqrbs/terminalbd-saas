<?php

namespace Appstore\Bundle\ProcurementBundle\Repository;
use Appstore\Bundle\AccountingBundle\Entity\AccountPurchase;
use Appstore\Bundle\AssetsBundle\Entity\AssetsPurchase;
use Core\UserBundle\Entity\User;
use Doctrine\ORM\EntityRepository;
use Setting\Bundle\ToolBundle\Entity\GlobalOption;
use Setting\Bundle\ToolBundle\Event\Glo;


/**
 * AccountPurchaseRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ReceiveRepository extends EntityRepository
{

    public function updateTotalAmount($receive)
    {
        $em =  $this->_em;
        $qb = $em->createQueryBuilder();
        $qb->from('ProcurementBundle:ReceiveItem','e');
        $qb->select('SUM(e.subTotal) AS amount');
        $qb->where("e.receive = :receive")->setParameter('receive', $receive->getId());
        $result = $qb->getQuery()->getSingleScalarResult();
        $receive->setSubTotal($result);
        $em->persist($receive);
        $em->flush();

    }


}
