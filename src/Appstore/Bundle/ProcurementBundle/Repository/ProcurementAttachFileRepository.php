<?php

namespace Appstore\Bundle\ProcurementBundle\Repository;
use Appstore\Bundle\ProcurementBundle\Entity\ProcurementAttachFile;
use Doctrine\ORM\EntityRepository;

/**
 * BranchRequisitionRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ProcurementAttachFileRepository extends EntityRepository
{

	public function insertPoFile($entity, $data,$file) {

		foreach ( $data['vendor'] as $key => $vendor ) {
			if(!empty($vendor) and !empty($data['file'])) {

				if(isset($data['attachId'][ $key ]) and !empty($data['attachId'][ $key ])){
					$attach = $this->find($data['attachId'][ $key ]);
				}else{
					$attach = new ProcurementAttachFile();
				}
				$em     = $this->_em;
				if ( isset( $file['file'] ) ) {
					$img      = $file['file'][ $key ];
					$fileName = $img->getClientOriginalName();
					$imgName  = uniqid() . '.' . $fileName;
					$img->move( $entity->getUploadDir(), $imgName );
					$attach->setPath( $imgName );
				}
				$attach->setPurchaseOrder($entity);
				$attach->setVendor($vendor);
				$attach->setRemark($data['remark'][$key]);
				$em->persist( $attach );
				$em->flush();
			}
		}
	}
}
